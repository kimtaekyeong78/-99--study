<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
	<title>Study10</title>
	<link crossorigin="anonymous" media="all" rel="stylesheet" href="css/arraystudy.css">
	<link crossorigin="anonymous" media="all" rel="stylesheet" href="css/reset.css">
	<script type="text/javascript">

		window.onload = function() {

			let _cartlisWrap = document.getElementById('itemList')
			let chklist = document.getElementById('itemListWrap')
			let cart_view = document.getElementById('cartlistWrap')
			let _HTML = ''
			let __HTML = ''
			let ___HTML = ''
			

			let martitem = new Array(
				{name:'바나나', price: 1000},
				{name:'딸기', price: 2000},
				{name:'사과', price: 3000},
				{name:'오렌지', price: 4000},
			)

			let cartArray = new Array(
			)
		
			// 반복문을 통해 전체 배열 출력
			for(let i=0; i < martitem.length; i++ ){
				_HTML += '<li class="item">';
					_HTML += '<input class="name" id="martitemlist'+(i+1)+'" type="checkbox" data-price="'+ martitem[i].price +'" name="mart" value="'+martitem[i].name+'" />';
					_HTML += '<label for="martitemlist'+(i+1)+'">'+martitem[i].name+'</label>';
					_HTML += '<input class="counts" id="count'+i+'" disabled value="0" min="0" type="number" name="count">';
				_HTML += '</li>';
				
			}
			
			//innerHTML을 통해 생성
			_cartlisWrap.innerHTML = _HTML

			let _martItem = document.querySelectorAll('.item')
			let _carBt = document.getElementById('cartbt')
			let _count = document.getElementsByClassName('.counts')
			

			for( var i=0; _martItem.length > i; i++ ){

				let _cheked = _martItem[i].querySelector('.name')
				
				_cheked.addEventListener('change', function(event){

					let _target = event.currentTarget
					let _target_data = _target.dataset.price; // 해당 타켓의 가격
					let _target_name = _target.value; // 해당 타켓의 이름 == 값
					let _target_count = _target.parentNode.querySelector('.counts')	//클릭된 리스트의 개수 인풋박스
					let _target_this = this.checked
					let _checkdAll = document.getElementsByClassName('active')

					if(_target.checked){

						cartArray.push({name : _target_name, price : _target_data})
						// cartArray.push({name : _target_name, price : _target_data, item_acount : _target_data * _target_count.value})
					
						this.classList.add('active') //액티브 클래스
						_target_count.value = 1 //카운트인풋1
						_target_count.removeAttribute('disabled') //카운트disabled삭제
					
						_target_count.addEventListener('change', function(event){
							
							if( _target_count.value  < 1 ) { //수량이 0이면, 비활성

								_target.checked  = false;
								_target.parentNode.querySelector('.name').classList.remove('active')
								_target_count.setAttribute('disabled', 'disabled')

							} else {
								// 수량이 0보다 클 경우, 합산을 구한 배열을 추가
								let cartArray_find = cartArray.findIndex(function(find) { 

									if(find.name === _target_name) {

										return true;
									}

									return false;
																											
								});
								let item_target_count = _target_count.value
								let item_Amountprice = cartArray[cartArray_find]['price'] * _target_count.value
								
								let cart_item_set = new Array(
									{_target_name, _target_data , item_Amountprice, item_target_count}
									)

								let item_HTML = ""
								let price_HTML = ""
								let count_HTML = ""
								let amountprice_HTML = ""

								console.log(cart_item_set)
												
								for(let i=0; i < cart_item_set.length; i++ ){
								
								___HTML += '<tr class="cartlistarea">';
									___HTML += '<td id="cartitem'+(i+1)+'">' + cartArray[i].name + '</td>';
									___HTML += '<td id="cartprice'+(i+1)+'">' + cartArray[i].price + '</td>';
									___HTML += '<td id="cartcount'+(i+1)+'">' + item_target_count + '</td>';
									___HTML += '<td id="cartcountall'+(i+1)+'">' + cartArray[i].price * item_target_count + '</td>';
								___HTML += '</tr>';
								
								}
								cart_view.innerHTML = ___HTML

							}
							
						})																
											
						if( _checkdAll.length == 0 ){

						_carBt.setAttribute('disabled', 'disabled')

						}else{

						_carBt.removeAttribute('disabled') //장바구니버튼disabled삭제

						}
		
					}else{

						let cartArray_find = cartArray.findIndex(function(find) {

							if(find.name === _target_name) {
								return true;
							}

							return false;
							
						});
											
						cartArray.splice(cartArray_find, 1)
						
						this.classList.remove('active')
						_target_count.setAttribute('disabled', 'disabled')
						_target_count.value = 0

						if( _checkdAll.length == 0 ){

						_carBt.setAttribute('disabled', 'disabled')

						}else{

						_carBt.removeAttribute('disabled') //장바구니버튼disabled삭제

						}
					}
																	
				})
				
			}

			_carBt.addEventListener('click', function(){

				
															
			})

			
			// let test = document.getElementById('cartbt')
			// 		console.log(_cart);
			
			// 장바구니 담기

		}

		

	</script>
</head>
<body>
	<div id="container">

		<h1>Cart 만들기</h1>

		<div id="itemWrap">
			<ul id="itemList">

			</ul>
		</div>
		<button id="cartbt" disabled >장바구니 담기</button>
		<div id="cartWrap">
			<table id="carttable">
				<thead>
					<tr>
						<td>품목</td>
						<td>단가</td>
						<td>수량</td>
						<td>해당품목 합계</td>
					</tr>
				</thead>
				<tbody id="cartlistWrap">
				</tbody>
			</table>
		</div>
	</div>


	
<!-- <script type="text/javascript">


1. 장바구니 담기
2. 장바구니 뷰 ()
3. 구매하기 
   > 최종 구매한 것에 대한 배열을 새로 만들고, 
	
</script> -->
</body>
</html>