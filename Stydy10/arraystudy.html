<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
	<title>Study10</title>
	<link crossorigin="anonymous" media="all" rel="stylesheet" href="css/arraystudy.css">
	<link crossorigin="anonymous" media="all" rel="stylesheet" href="css/reset.css">
	<script type="text/javascript">

		localStorage.setItem('totalPrice', 300000)
		localStorage.setItem('name', "BJH")

		window.onload = function() {
			
			let _localPoint = document.getElementById('price').innerHTML += localStorage.getItem('totalPrice')


			let _cartlisWrap = document.getElementById('itemList')
			let chklist = document.getElementById('itemListWrap')
			let cart_view = document.getElementById('cartlistWrap')
			let _HTML = ''
			let __HTML = ''
			

			let martitem = new Array(
				{name:'바나나', price: 1000},
				{name:'딸기', price: 2000},
				{name:'사과', price: 3000},
				{name:'오렌지', price: 4000},
				{name:'수박', price: 12000},
				{name:'키위', price: 5000},
			)
			let cartArray = new Array(
			)
			let cartArrayTotal = new Array (

			)
		
			// 반복문을 통해 전체 배열 출력
			for(let i=0; i < martitem.length; i++ ){
				_HTML += '<li class="item">';
					_HTML += '<input class="name" id="martitemlist'+(i+1)+'" type="checkbox" data-price="'+ martitem[i].price +'" name="mart" value="'+martitem[i].name+'" />';
					_HTML += '<label for="martitemlist'+(i+1)+'">'+martitem[i].name+'</label>';
					_HTML += '<input class="counts" id="count'+i+'" placeholder="0" disabled min="0" type="number" name="count">';
				_HTML += '</li>';
				
			}

			
			//innerHTML을 통해 생성
			_cartlisWrap.innerHTML = _HTML

			let _martItem = document.querySelectorAll('.item')
			let _carBt = document.getElementById('cartbt')
			let _count = document.getElementsByClassName('.counts')
			
			
			for( var i=0; _martItem.length > i; i++ ){

				let _cheked = _martItem[i].querySelector('.name')
				
				_cheked.addEventListener('change', function(event){

					let _target = event.currentTarget
					let _target_data = _target.dataset.price; // 해당 타켓의 가격
					let _target_name = _target.value; // 해당 타켓의 이름 == 값
					let _target_count = _target.parentNode.querySelector('.counts')	//클릭된 리스트의 개수 인풋박스
					let _target_this = this.checked
					let _checkdAll = document.getElementsByClassName('active')
					
					
					if(_target.checked){
						
						cartArray.push({name : _target_name, price : _target_data, count : 1, amount :_target_data * 1})
												
						_target_count.value = 1 //카운트인풋1

						_target.classList.add('active')

						_target_count.removeAttribute('disabled') //카운트disabled삭제

						_carBt.removeAttribute('disabled') //장바구니버튼disabled삭제
					
						_target_count.addEventListener('change', function(event){
							
							let cartArray_find = cartArray.findIndex(function(find) {

								if(find.name === _target_name) {
									return true;
								}

								return false;
								
							});
							
							if( _target_count.value  < 1 ) { //수량이 0이면, 
								cartArray.splice(cartArray_find, 1)
								
								_target.checked  = false;
								_target_count.setAttribute('disabled', 'disabled')
								_target.classList.remove('active')

								if(_checkdAll.length == 0) {

								_carBt.setAttribute('disabled', 'disabled')
									
								} return false


							}else{
								cartArray[cartArray_find].count = _target_count.value
								cartArray[cartArray_find].amount = _target_count.value * _target_data
								_carBt.removeAttribute('disabled') //장바구니버튼disabled삭제
							
							}
									 												
						})	
		
					}else{

						_target.classList.remove('active')

						let cartArray_find = cartArray.findIndex(function(find) {

							if(find.name === _target_name) {
								return true;
							}

							return false;
													
						});
											
						cartArray.splice(cartArray_find, 1)
						
						_target_count.setAttribute('disabled', 'disabled')
						_target_count.value = 0

						if( _checkdAll.length == 0 ){

						_carBt.setAttribute('disabled', 'disabled')

						}else{

						_carBt.removeAttribute('disabled') //장바구니버튼disabled삭제

						}
					}																		
				})
			}

			_carBt.addEventListener('click', function(){

				document.getElementById('cartWrap').style.display = 'block';
				
				cartListItemTotalval = cartArray.reduce((prev, curr) => {
					return (prev += curr.amount)
				}, 0)

				cartArrayTotal = {totalPrice : cartListItemTotalval}
				
				let cartListItemWrap = document.getElementById('cartlistWrap')		
				let cartListItemTotalWrap = document.getElementById('cartTotalWrap')					
				let cartList = document.getElementsByClassName('cartListItem')
				let totalPrice = document.getElementById('totalPriceval')

				__HTML = ""
				cartListItemTotalWrap.innerHTML = ""
					
				for(let i=0; i < cartArray.length; i++){
					
					__HTML += '<tr class="cartListItem">'
						__HTML += '<td>' + cartArray[i].name + '</td>'
						__HTML += '<td>' + cartArray[i].price + '</td>'
						__HTML += '<td>' + cartArray[i].count + '</td>'
						__HTML += '<td>' + cartArray[i].amount + '</td>'
					__HTML += '</tr>' 
										
				}
													
				cartListItemWrap.innerHTML = __HTML
				cartListItemTotalWrap.innerHTML += '<tr>' + '<td class="total" colspan="2">' + "전체 구매 금액" + '</td>' + '<td id="totalPriceval" class="total" colspan="2" date-total= '+cartListItemTotalval+'>' + cartListItemTotalval + '</td>' + '</tr>'
										
			})

			
			document.getElementById('buyBt').addEventListener('click', function(){
				alert(localStorage.getItem('totalPrice') - cartListItemTotalval + "잔액이 남게됩니다") 

			})

		}

		function cartWrapClose() {
				
				document.getElementById('cartWrap').style.display = 'none';
		}
			

	</script>
</head>
<body>
	<div id="container">
		<button type="button" id="price"></button>
		<h1>Cart 만들기</h1>

		<div id="itemWrap">
			<ul id="itemList">

			</ul>
		</div>
		<button id="cartbt" disabled >장바구니 담기</button>
		<div id="cartWrap">
			<table id="cartTable">
				<thead>
					<tr>
						<td>품목</td>
						<td>단가</td>
						<td>수량</td>
						<td>해당품목 합계</td>
					</tr>
				</thead>
				<tbody id="cartlistWrap">
				</tbody>
				<tfoot id="cartTotalWrap">
				</tfoot>
			</table>
			<button id="buyBt">구매하기</button>
			<button id="closeBt" onclick="cartWrapClose();">다시담기</button>
		</div>
	</div>


	
<!-- <script type="text/javascript">


1. 장바구니 담기
2. 장바구니 뷰 ()
3. 구매하기 
   > 최종 구매한 것에 대한 배열을 새로 만들고, 
	
</script> -->
</body>
</html>